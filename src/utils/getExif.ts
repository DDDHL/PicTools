export async function parsePhotoMetadata(
  imgPath: string
): Promise<{ [key: string]: string }> {
  try {
    const tags = await window.safeIpc.invoke('get-exif', imgPath)
    return formatter(tags)
  } catch (error) {
    console.error('读取EXIF数据时出错:', error)
    return {}
  }
}

// 指定key值替换
const formatter = (tags: { [key: string]: string }) => {
  const translatedData: { [key: string]: string } = {}
  // 替换时间
  for (const key in tags) {
    if (key.includes('GPS')) {
      console.log(key)
    }
    if (
      Object.prototype.toString.call(tags[key]) === '[object Object]' &&
      (key.toLocaleLowerCase().includes('date') ||
        key.toLocaleLowerCase().includes('time'))
    ) {
      tags[key] = (<any>tags[key]).rawValue ?? '时间解析失败'
    }
    // 中文解析，如果没有映射则使用原字段名称
    const translatedKey = fieldTranslationMap[key] || key
    translatedData[translatedKey] = tags[key]
  }
  return translatedData
}

const convertDMSToDD = (dms, ref) => {
  const degrees = dms[0]
  const minutes = dms[1]
  const seconds = dms[2]
  const dd = degrees + minutes / 60 + seconds / 3600
  return ref === 'S' || ref === 'W' ? -dd : dd
}

// 中文翻译
const fieldTranslationMap: { [key: string]: string } = {
  Make: '制造商',
  Model: '型号',
  XResolution: 'X分辨率',
  YResolution: 'Y分辨率',
  ResolutionUnit: '分辨率单位',
  Software: '软件',
  ModifyDate: '修改日期',
  ExposureTime: '曝光时间',
  FNumber: '光圈值',
  ExposureProgram: '曝光程序',
  ISO: 'ISO感光度',
  SensitivityType: '灵敏度类型',
  RecommendedExposureIndex: '推荐曝光指数',
  ExifVersion: 'Exif版本',
  DateTimeOriginal: '拍摄日期',
  CreateDate: '创建日期',
  OffsetTime: '时区偏移',
  OffsetTimeOriginal: '拍摄时区偏移',
  OffsetTimeDigitized: '数字化时区偏移',
  ShutterSpeedValue: '快门速度值',
  ApertureValue: '光圈值',
  ExposureCompensation: '曝光补偿',
  MeteringMode: '测光模式',
  LightSource: '光源',
  Flash: '闪光灯',
  FocalLength: '焦距',
  SubSecTimeOriginal: '拍摄子秒时间',
  SubSecTimeDigitized: '数字化子秒时间',
  ColorSpace: '色彩空间',
  FocalPlaneXResolution: '焦平面X分辨率',
  FocalPlaneYResolution: '焦平面Y分辨率',
  FocalPlaneResolutionUnit: '焦平面分辨率单位',
  SensingMethod: '感应方法',
  FileSource: '文件来源',
  SceneType: '场景类型',
  CFAPattern: 'CFA模式',
  CustomRendered: '自定义渲染',
  ExposureMode: '曝光模式',
  WhiteBalance: '白平衡',
  FocalLengthIn35mmFormat: '35mm格式焦距',
  SceneCaptureType: '场景捕捉类型',
  GainControl: '增益控制',
  Contrast: '对比度',
  Saturation: '饱和度',
  Sharpness: '锐度',
  SubjectDistanceRange: '主体距离范围',
  SerialNumber: '序列号',
  LensInfo: '镜头信息',
  LensMake: '镜头制造商',
  LensModel: '镜头型号',
  LensSerialNumber: '镜头序列号',
  Orientation: '方向',
  YCbCrPositioning: 'YCbCr位置控制',
  MaxApertureValue: '最大光圈值',
  ExifImageHeight: 'Exif图像高度',
  BrightnessValue: '亮度值',
  FlashpixVersion: 'Flashpix版本',
  SubSecTime: '亚秒',
  ExifImageWidth: 'Exif图像宽度',
  ComponentsConfiguration: '组件配置',
  GPSLatitude: 'GPS纬度',
  GPSAltitude: 'GPS海拔',
  GPSSpeed: 'GPS速度',
  GPSAltitudeRef: 'GPS海拔参考',
  GPSTimeStamp: 'GPS时间戳',
  GPSLongitude: 'GPS经度',
  latitude: '纬度',
  longitude: '经度',
  GPSDateStamp: 'GPS日期时间',
  GPSLatitudeRef: 'GPS纬度参考',
  GPSLongitudeRef: 'GPS经度参考',
  GPSProcessingMethod: 'GPS处理方法',
  GPSSpeedRef: 'GPS速度参考',
  BitDepth: '位深度',
  ColorType: '颜色类型',
  Compression: '压缩类型',
  Filter: '滤镜类型',
  ImageHeight: '图像高度',
  ImageWidth: '图像宽度',
  Interlace: '扫描方式',
  SourceFile: '源文件',
  errors: '错误',
  tz: '时区',
  tzSource: '时区来源',
  ExifToolVersion: 'Exif工具版本',
  FileName: '文件名',
  Directory: '目录',
  FileSize: '文件大小',
  FilePermissions: '文件权限',
  FileType: '文件类型',
  FileTypeExtension: '文件扩展名',
  MIMEType: 'MIME类型',
  ExifByteOrder: 'Exif字节顺序',
  AIScene: 'AI场景',
  Hdr: 'HDR',
  OpMode: '操作模式',
  FilterId: '滤镜ID',
  Mirror: '镜像',
  SensorType: '传感器类型',
  SmallPicture: '小图片',
  ZoomMultiple: '缩放倍数',
  InteropIndex: '互操作索引',
  InteropVersion: '互操作版本',
  ThumbnailOffset: '缩略图偏移量',
  ThumbnailLength: '缩略图长度',
  ProfileCMMType: '配置文件CMM类型',
  ProfileVersion: '配置文件版本',
  ProfileClass: '配置文件类别',
  ColorSpaceData: '色彩空间数据',
  ProfileConnectionSpace: '配置文件连接空间',
  ProfileDateTime: '配置文件日期时间',
  ProfileFileSignature: '配置文件签名',
  PrimaryPlatform: '主要平台',
  CMMFlags: 'CMM标志',
  DeviceManufacturer: '设备制造商',
  DeviceModel: '设备型号',
  DeviceAttributes: '设备属性',
  RenderingIntent: '渲染意图',
  ConnectionSpaceIlluminant: '连接空间光源',
  ProfileCreator: '配置文件创建者',
  ProfileID: '配置文件ID',
  ProfileDescription: '配置文件描述',
  ProfileCopyright: '配置文件版权',
  MediaWhitePoint: '媒体白点',
  RedMatrixColumn: '红色矩阵列',
  GreenMatrixColumn: '绿色矩阵列',
  BlueMatrixColumn: '蓝色矩阵列',
  RedTRC: '红色TRC',
  ChromaticAdaptation: '色度适应',
  BlueTRC: '蓝色TRC',
  GreenTRC: '绿色TRC',
  EncodingProcess: '编码过程',
  BitsPerSample: '每个样本的位数',
  ColorComponents: '颜色组件',
  YCbCrSubSampling: 'YCbCr子采样',
  Aperture: '光圈',
  ImageSize: '图像尺寸',
  Megapixels: '百万像素',
  ScaleFactor35efl: '35mm等效缩放因子',
  ShutterSpeed: '快门速度',
  SubSecCreateDate: '创建日期子秒',
  SubSecDateTimeOriginal: '拍摄日期子秒',
  SubSecModifyDate: '修改日期子秒',
  ThumbnailImage: '缩略图',
  GPSDateTime: 'GPS日期时间',
  CircleOfConfusion: '混乱圈',
  FOV: '视野',
  FocalLength35efl: '35mm等效焦距',
  HyperfocalDistance: '超焦距',
  LightValue: '光值',
  warnings: '警告',
  DisplayedUnitsX: '显示单位X',
  DisplayedUnitsY: '显示单位Y',
  CurrentIPTCDigest: '当前IPTCDigest',
  CodedCharacterSet: '编码字符集',
  ApplicationRecordVersion: '应用记录版本',
  TimeCreated: '创建时间',
  DigitalCreationDate: '数字创建日期',
  DigitalCreationTime: '数字创建时间',
  PhotoshopThumbnail: 'Photoshop缩略图',
  IPTCDigest: 'IPTCDigest',
  MediaBlackPoint: '媒体黑点',
  DeviceMfgDesc: '设备制造描述',
  DeviceModelDesc: '设备型号描述',
  ViewingCondDesc: '观看条件描述',
  ViewingCondIlluminant: '观看条件光源',
  ViewingCondSurround: '观看条件周围',
  ViewingCondIlluminantType: '观看条件光源类型',
  Luminance: '亮度',
  MeasurementObserver: '测量观察者',
  MeasurementBacking: '测量背景',
  MeasurementGeometry: '测量几何',
  MeasurementFlare: '测量耀斑',
  MeasurementIlluminant: '测量光源',
  Technology: '技术',
  XMPToolkit: 'XMP工具包',
  CreatorTool: '创建工具',
  Rating: '评级',
  MetadataDate: '元数据日期',
  Lens: '镜头',
  ImageNumber: '图像编号',
  DistortionCorrectionAlreadyApplied: '已应用失真校正',
  LateralChromaticAberrationCorrectionAlreadyApplied: '已应用横向色差校正',
  VignetteCorrectionAlreadyApplied: '已应用暗角校正',
  DateCreated: '创建日期',
  DocumentID: '文档ID',
  OriginalDocumentID: '原始文档ID',
  InstanceID: '实例ID',
  Format: '格式',
  RawFileName: '原始文件名',
  Version: '版本',
  ProcessVersion: '处理版本',
  ColorTemperature: '色温',
  Tint: '色调',
  Exposure2012: '曝光2012',
  Contrast2012: '对比度2012',
  Highlights2012: '高光2012',
  Shadows2012: '阴影2012',
  Whites2012: '白色2012',
  Blacks2012: '黑色2012',
  Texture: '质感',
  Clarity2012: '清晰度2012',
  Dehaze: '去雾',
  Vibrance: '生动度',
  ParametricShadows: '参数化阴影',
  ParametricDarks: '参数化暗部',
  ParametricLights: '参数化光亮',
  ParametricHighlights: '参数化高光',
  ParametricShadowSplit: '参数化阴影分割',
  ParametricMidtoneSplit: '参数化中间色调分割',
  ParametricHighlightSplit: '参数化高光分割',
  SharpenRadius: '锐化半径',
  SharpenDetail: '锐化细节',
  SharpenEdgeMasking: '锐化边缘遮罩',
  LuminanceSmoothing: '亮度平滑',
  ColorNoiseReduction: '颜色噪声减少',
  ColorNoiseReductionDetail: '颜色噪声减少细节',
  ColorNoiseReductionSmoothness: '颜色噪声减少平滑度',
  HueAdjustmentRed: '红色调整色调',
  HueAdjustmentOrange: '橙色调整色调',
  HueAdjustmentYellow: '黄色调整色调',
  HueAdjustmentGreen: '绿色调整色调',
  HueAdjustmentAqua: '青色调整色调',
  HueAdjustmentBlue: '蓝色调整色调',
  HueAdjustmentPurple: '紫色调整色调',
  HueAdjustmentMagenta: '洋红色调整色调',
  SaturationAdjustmentRed: '红色调整饱和度',
  SaturationAdjustmentOrange: '橙色调整饱和度',
  SaturationAdjustmentYellow: '黄色调整饱和度',
  SaturationAdjustmentGreen: '绿色调整饱和度',
  SaturationAdjustmentAqua: '青色调整饱和度',
  SaturationAdjustmentBlue: '蓝色调整饱和度',
  SaturationAdjustmentPurple: '紫色调整饱和度',
  SaturationAdjustmentMagenta: '洋红色调整饱和度',
  LuminanceAdjustmentRed: '红色调整亮度',
  LuminanceAdjustmentOrange: '橙色调整亮度',
  LuminanceAdjustmentYellow: '黄色调整亮度',
  LuminanceAdjustmentGreen: '绿色调整亮度',
  LuminanceAdjustmentAqua: '青色调整亮度',
  LuminanceAdjustmentBlue: '蓝色调整亮度',
  LuminanceAdjustmentPurple: '紫色调整亮度',
  LuminanceAdjustmentMagenta: '洋红色调整亮度',
  SplitToningShadowHue: '分离色调阴影色相',
  SplitToningShadowSaturation: '分离色调阴影饱和度',
  SplitToningHighlightHue: '分离色调高光色相',
  SplitToningHighlightSaturation: '分离色调高光饱和度',
  SplitToningBalance: '分离色调平衡',
  ColorGradeMidtoneHue: '色彩分级中间色调色相',
  ColorGradeMidtoneSat: '色彩分级中间色调饱和度',
  ColorGradeShadowLum: '色彩分级阴影亮度',
  ColorGradeMidtoneLum: '色彩分级中间色调亮度',
  ColorGradeHighlightLum: '色彩分级高光亮度',
  ColorGradeBlending: '色彩分级混合',
  ColorGradeGlobalHue: '色彩分级全局色相',
  ColorGradeGlobalSat: '色彩分级全局饱和度',
  ColorGradeGlobalLum: '色彩分级全局亮度',
  AutoLateralCA: '自动横向色差',
  LensProfileEnable: '启用镜头配置文件',
  LensManualDistortionAmount: '镜头手动失真量',
  VignetteAmount: '暗角量',
  DefringePurpleAmount: '去紫边量',
  DefringePurpleHueLo: '去紫边色相低',
  DefringePurpleHueHi: '去紫边色相高',
  DefringeGreenAmount: '去绿边量',
  DefringeGreenHueLo: '去绿边色相低',
  DefringeGreenHueHi: '去绿边色相高',
  PerspectiveUpright: '透视直立',
  PerspectiveVertical: '透视垂直',
  PerspectiveHorizontal: '透视水平',
  PerspectiveRotate: '透视旋转',
  PerspectiveAspect: '透视外观',
  PerspectiveScale: '透视比例',
  PerspectiveX: '透视X',
  PerspectiveY: '透视Y',
  GrainAmount: '颗粒量',
  PostCropVignetteAmount: '裁剪后暗角量',
  ShadowTint: '阴影色调',
  RedHue: '红色色相',
  RedSaturation: '红色饱和度',
  GreenHue: '绿色色相',
  GreenSaturation: '绿色饱和度',
  BlueHue: '蓝色色相',
  BlueSaturation: '蓝色饱和度',
  HDREditMode: 'HDR编辑模式',
  OverrideLookVignette: '覆盖外观暗角',
  ToneCurveName2012: '2012色调曲线名称',
  CameraProfile: '相机配置文件',
  CameraProfileDigest: '相机配置文件摘要',
  HasSettings: '有设置',
  CropTop: '裁剪上部',
  CropLeft: '裁剪左部',
  CropBottom: '裁剪底部',
  CropRight: '裁剪右部',
  CropAngle: '裁剪角度',
  CropConstrainToWarp: '裁剪约束变形',
  HasCrop: '有裁剪',
  AlreadyApplied: '已应用',
  History: '历史记录',
  DerivedFrom: '衍生自',
  ToneCurvePV2012: '2012色调曲线PV',
  ToneCurvePV2012Red: '2012色调曲线PV红色',
  ToneCurvePV2012Green: '2012色调曲线PV绿色',
  ToneCurvePV2012Blue: '蓝色曲线',
  PointColors: '点颜色',
  Look: '外观',
  DCTEncodeVersion: 'DCT 编码版本',
  APP14Flags0: 'APP14 标志 0',
  APP14Flags1: 'APP14 标志 1',
  ColorTransform: '颜色转换',
  DateTimeCreated: '创建日期时间',
  DigitalCreationDateTime: '数字创建日期时间',
  LensID: '镜头ID',
  FileAccessDate: '文件访问日期',
  FileCreateDate: '文件创建日期',
  FileModifyDate: '文件修改日期',
  Artist: '艺术家',
  Copyright: '版权',
  CompressedBitsPerPixel: '压缩比特每像素',
  MakerNoteVersion: '制造商笔记版本',
  Quality: '质量',
  FocusMode: '对焦模式',
  FlashSetting: '闪光灯设置',
  FlashType: '闪光灯类型',
  WB_RBLevels: '白平衡红蓝平衡',
  ProgramShift: '程序移位',
  ExposureDifference: '曝光差异',
  ImageBoundary: '图像边界',
  ExternalFlashExposureComp: '外部闪光曝光补偿',
  FlashExposureBracketValue: '闪光曝光包围值',
  ExposureBracketValue: '曝光包围值',
  CropHiSpeed: '高速裁剪',
  ExposureTuning: '曝光调节',
  VRInfoVersion: '防抖信息版本',
  VibrationReduction: '防抖',
  VRMode: '防抖模式',
  VRType: '防抖类型',
  'ActiveD-Lighting': '主动D-光照',
  PictureControlVersion: '照片控制版本',
  PictureControlName: '照片控制名称',
  PictureControlBase: '照片控制基础',
  PictureControlAdjust: '照片控制调整',
  PictureControlQuickAdjust: '照片控制快速调整',
  MidRangeSharpness: '中范围锐度',
  Clarity: '清晰度',
  Brightness: '亮度',
  Hue: '色调',
  FilterEffect: '滤镜效果',
  ToningEffect: '色调效果',
  ToningSaturation: '色调饱和度',
  TimeZone: '时区',
  DaylightSavings: '夏令时',
  DateDisplayFormat: '日期显示格式',
  ISOExpansion: 'ISO扩展',
  ISO2: 'ISO2',
  ISOExpansion2: 'ISO扩展2',
  VignetteControl: '暗角控制',
  AutoDistortionControl: '自动失真控制',
  ShutterMode: '快门模式',
  HDRInfoVersion: 'HDR信息版本',
  HDR: 'HDR',
  HDRLevel: 'HDR级别',
  MechanicalShutterCount: '机械快门次数',
  ImageSizeRAW: 'RAW图像大小',
  WhiteBalanceFineTune: '白平衡微调',
  JPGCompression: 'JPG压缩',
  ColorTemperatureAuto: '自动色温',
  BurstGroupID: '连拍组ID',
  LensType: '镜头类型',
  FlashMode: '闪光模式',
  ShootingMode: '拍摄模式',
  LensFStops: '镜头光圈值',
  ShotInfoVersion: '拍摄信息版本',
  FirmwareVersion: '固件版本',
  FirmwareVersion2: '固件版本2',
  FirmwareVersion3: '固件版本3',
  NumberOffsets: '偏移数量',
  IntervalShooting: '间隔拍摄',
  ImageArea: '图像区域',
  RollAngle: '滚动角度',
  PitchAngle: '俯仰角度',
  YawAngle: '偏航角度',
  NoiseReduction: '降噪',
  ColorBalanceVersion: '色彩平衡版本',
  LensDataVersion: '镜头数据版本',
  LensMountType: '镜头卡口类型',
  MaxAperture: '最大光圈',
  FocusDistance: '对焦距离',
  LensPositionAbsolute: '镜头位置绝对值',
  RetouchHistory: '修饰历史',
  ImageDataSize: '图像数据大小',
  ShutterCount: '快门次数',
  FlashInfoVersion: '闪光信息版本',
  FlashSource: '闪光来源',
  ExternalFlashFirmware: '外部闪光固件',
  ExternalFlashFlags: '外部闪光标志',
  FlashCommanderMode: '闪光指挥模式',
  FlashControlMode: '闪光控制模式',
  FlashGNDistance: '闪光指南距离',
  FlashColorFilter: '闪光滤色片',
  FlashGroupAControlMode: '闪光组A控制模式',
  FlashGroupBControlMode: '闪光组B控制模式',
  FlashGroupCControlMode: '闪光组C控制模式',
  FlashIlluminationPattern: '闪光照明模式',
  FlashGroupACompensation: '闪光组A补偿',
  FlashGroupBCompensation: '闪光组B补偿',
  FlashGroupCCompensation: '闪光组C补偿',
  VariProgram: '变程序',
  MultiExposureVersion: '多重曝光版本',
  MultiExposureMode: '多重曝光模式',
  MultiExposureShots: '多重曝光次数',
  MultiExposureOverlayMode: '多重曝光叠加模式',
  HighISONoiseReduction: '高ISO降噪',
  AFInfo2Version: 'AF信息2版本',
  ContrastDetectAF: '对比检测自动对焦',
  AFAreaMode: '自动对焦区域模式',
  PhaseDetectAF: '相位检测自动对焦',
  PrimaryAFPoint: '主要自动对焦点',
  AFPointsUsed: '使用的自动对焦点',
  FileInfoVersion: '文件信息版本',
  MemoryCardNumber: '存储卡编号',
  DirectoryNumber: '目录编号',
  FileNumber: '文件编号',
  AFFineTune: '自动对焦微调',
  AFFineTuneIndex: '自动对焦微调索引',
  AFFineTuneAdj: '自动对焦微调调整',
  AFFineTuneAdjTele: '远摄微调调整',
  RetouchInfoVersion: '修饰信息版本',
  RetouchNEFProcessing: '修饰NEF处理',
  SilentPhotography: '静音拍摄',
  UserComment: '用户评论',
  Flashpix版本: 'Flashpix版本',
  CompositeImage: '复合图像',
  GPSVersionID: 'GPS版本ID',
  MPFVersion: 'MPF版本',
  NumberOfImages: '图像数量',
  MPImageFlags: 'MP图像标志',
  MPImageFormat: 'MP图像格式',
  MPImageType: 'MP图像类型',
  MPImageLength: 'MP图像长度',
  MPImageStart: 'MP图像起始位置',
  DependentImage1EntryNumber: '依赖图像1条目编号',
  DependentImage2EntryNumber: '依赖图像2条目编号',
  BlueBalance: '蓝色平衡',
  RedBalance: '红色平衡',
  AutoFocus: '自动对焦',
  LensSpec: '镜头规格',
  DOF: '景深',
  PowerUpTime: '开机时间',
  ContrastCurve: '对比曲线',
}
